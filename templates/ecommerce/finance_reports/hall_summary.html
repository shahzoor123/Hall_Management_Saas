{% extends 'partials/base.html' %} {% load static %} {% block title%}Dashboard{% endblock title %} {% block extra_css %}
<!-- plugin css -->
<link href="{% static 'libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css' %}" rel="stylesheet"
  type="text/css" />




{% endblock extra_css %} {% block content %}



<div class="main-content">
  <div class="page-content">
    <!-- start page title -->
    <div class="page-title-box">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col-sm-6">
            <div class="page-title">
              <h4>Finance Dashboard</h4>
              <ol class="breadcrumb m-0">
                <li class="breadcrumb-item">
                  <a href="javascript: void(0);">Hall</a>
                </li>
                <li class="breadcrumb-item">
                  <a href="javascript: void(0);">Dashboard</a>
                </li>
                <li class="breadcrumb-item active">Home</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- end page title -->





    <div class="container_fluid">
      <div class="row">
          <div class="col-md-6 col-sm-12">
              <!-- Element 1 -->
              <div class="card">
                  <div class="card-body">
                      <h4 class="header-title">Monthly Sales</h4>
                      <canvas id="salesChartMonthly"></canvas>
                  </div>
              </div>
          </div>
          <div class="col-md-6 col-sm-12">
              <!-- Element 2 -->
              <div class="card">
                  <div class="card-body">
                      <h4 class= "header-title">Daily Sales</h4>
                      <canvas id="salesChartDaily"></canvas>
                  </div>
              </div>
          </div>
      </div>
      <div class="row">
          <div class="col-md-6 col-sm-12">
              <!-- Element 3 -->
              <div class="card">
                  <div class="card-body">
                      <h4 class="header-title">Monthly Expense</h4>
                      <canvas id="expensesChartMonthly"></canvas>
                  </div>
              </div>
          </div>
          <div class="col-md-6 col-sm-12">
              <!-- Element 4 -->
              <div class="card">
                  <div class="card-body">
                      <h4 class="header-title">Daily Expense</h4>
                      <canvas id="expensesChartDaily"></canvas>
                  </div>
              </div>
          </div>
      </div>
  </div>
  
  





    
           <div class="col-xl-4">
            <div class="row">
              <div class="col-xl-6 col-md-6">
                <div class="card">
                  <div class="card-body">
                    <div class="text-center">
                      <p class="font-size-16">Events This Month</p>
                      <div class="mini-stat-icon mx-auto mb-4 mt-3">
                        <span class="avatar-title rounded-circle bg-soft-primary">
                          <i class="mdi mdi-calendar-month text-primary font-size-20"></i>
                        </span>
                      </div>
                      <h5 class="font-size-22"></h5>
                      <p class="text-muted">
                        {% if total_events_this_month %}
                        {{total_events_this_month}} Target
                        {% else %}
                        0 Target
                        {% endif %}

                      </p>
                      <div class="progress mt-3" style="height: 4px">
                        <div id="month-progressBar" class="progress-bar progress-bar bg-primary" role="progressbar"
                          style="width: 70%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="70"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div> 

               <div class="col-xl-6 col-md-6">
                <div class="card">
                  <div class="card-body">
                    <div class="text-center">
                      <p class="font-size-16">Events This Year</p>
                      <div class="mini-stat-icon mx-auto mb-4 mt-3">
                        <span class="avatar-title rounded-circle bg-soft-success">
                          <i class="mdi mdi-finance text- font-size-20"></i>
                        </span>
                      </div>
                      <h5 class="font-size-22"></h5>
                      <p class="text-muted">
                        {% if total_events_this_year %}
                        {{total_events_this_year}} Target
                        {% else %}
                        0 Target
                        {% endif %}

                      </p>
                      <div class="progress mt-3" style="height: 4px">
                        <div id="yearly-progressBar" class="progress-bar progress-bar bg-success" role="progressbar"
                          aria-valuenow="{{total_events_this_year}}" aria-valuemin="0"
                          aria-valuemax="{{ total_events_this_year }}"></div>
                      </div>

                     


                    </div>
                  </div>
                </div>
              </div>
            </div> 
            <div class="card">
              <div class="card-body">
                <h4 class="header-title mb-4">Expense Stastics</h4>
                <div class="media">
                  <h4>&#8360; 14,235</h4>
                  <div class="media-body ps-3">
                    <div class="dropdown">
                      <button class="btn btn-light btn-sm dropdown-toggle" type="button" id="dropdownMenuButton"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Today<i class="mdi mdi-chevron-down ms-1"></i>
                      </button>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="#">Yesterday</a>
                        <a class="dropdown-item" href="#">Last Week</a>
                        <a class="dropdown-item" href="#">Last Month</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="mt-3">
                  <div id="stastics-charts"></div>
                </div>
              </div>
            </div>
          </div>
        </div> 
      
      </div>
    </div>

  </div>
</div>

<h1 hidden id="sale" data-my-variable="{{sale}}"></h1>
<h1 hidden id="expense" data-my-variable="{{expense}}"></h1>
<!-- End Page-content -->
{% endblock content %} {% block extra_javascript %}


<!-- apexcharts -->
<script src="{% static 'libs/apexcharts/dist/apexcharts.min.js' %}"></script>
<!-- Plugins js-->
<script src="{% static 'libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>
<script src="{% static 'libs/admin-resources/jquery.vectormap/maps/jquery-jvectormap-world-mill-en.js' %}"></script>

<!-- <script src="{% static 'js/pages/dashboard.init.js' %}"></script> -->
<script src="{% static 'libs/chart.js/dist/Chart.bundle.min.js' %}"></script>
<script src="{% static 'js/pages/chartjs.init.js' %}"></script>
<script src="{% static 'libs/chartist/dist/chartist.min.js' %}"></script>
<script src="{% static 'libs/chartist-plugin-tooltips-updated/dist/chartist-plugin-tooltip.min.js' %}"></script>


<script src="{% static 'js/pages/chart.js' %}"></script>

<!-- Bar chart -->
<script>
  // Get the total_events_this_year value from the hidden element or another source
  var totalEventsThisYear = parseInt(
    document
      .getElementById("total_events_this_year")
      .getAttribute("data-my-variable")
  );

  var total_events_this_month = parseInt(
    document
      .getElementById("total_events_this_month")
      .getAttribute("data-my-variable")
  );

  // Calculate the percentage
  var yearly_percentage = totalEventsThisYear;
  var montly_percentage = totalEventsThisYear;
  // Set the style attribute of the progress bar
  document.getElementById(
    "yearly-progressBar"
  ).style.width = yearly_percentage + "%";
  document.getElementById(
    "month-progressBar"
  ).style.width = montly_percentage + "%";
</script>


<script>
  // Get the values from the data attributes
  var montly_sale = document.getElementById("sale").getAttribute("data-my-variable");
  var montly_expense = document.getElementById("expense").getAttribute("data-my-variable");



  
  // // Parse the values as JSON arrays
  var totalSales = JSON.parse(montly_sale);
  var totalExpense = JSON.parse(montly_expense);


  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

  const salesData = Array.from({ length: 12 }, () => Math.floor(Math.random() * 1000));
  const expensesData = Array.from({ length: 12 }, () => Math.floor(Math.random() * 500));

  const salesChartMonthlyCtx = document.getElementById('salesChartMonthly').getContext('2d');

  const salesChartDailyCtx = document.getElementById('salesChartDaily').getContext('2d');

  const expensesChartMonthlyCtx = document.getElementById('expensesChartMonthly').getContext('2d');

  const expensesChartDailyCtx = document.getElementById('expensesChartDaily').getContext('2d');




  const salesChartMonthly = new Chart(salesChartMonthlyCtx, {
    type: 'bar',
    data: {
      labels: months,
      datasets: [{
        label: 'Monthly Sales',
        data: totalSales,
        backgroundColor: [

          'rgba(51, 255, 189, 0.5)'
        ],
        borderColor: [

          'rgba(0, 0, 0, 0.5)'
        ],
        borderWidth: 2

      }],
    },
    options: {
      onClick: function (event, elements) {
        if (elements.length > 0) {
          const selectedIndex = elements[0].index;
          console.log(selectedIndex);
          updateSalesChart(selectedIndex);
        }
      }
    }
  });



  function updateSalesChart(selectedIndex) {
    const updatedExpensesData = salesData.map((value, index) => (index === selectedIndex ? value : 0));
    salesChartDaily.data.datasets[0].data = updatedExpensesData;
    salesChartDaily.update();
  }



  const salesChartDaily = new Chart(salesChartDailyCtx, {
    type: 'bar',
    data: {
      labels: months,
      datasets: [{
        label: 'Monthly Expenses',
        data: salesData,
        backgroundColor: [

        'rgba(51, 255, 189, 0.5)'
        ],
        borderColor: [

          'rgba(0, 0, 0, 0.5)'
        ],
        borderWidth: 2
      }],
    },
  });

  

  const expensesChartMonthly = new Chart(expensesChartMonthlyCtx, {
    type: 'bar',
    data: {
      labels: months,
      datasets: [{
        label: 'Monthly Expenses',
        data: totalExpense,
        backgroundColor: [

          'rgba(255, 87, 51, 0.5)'
        ],
        borderColor: [

          'rgba(0, 0, 0, 0.5)'
        ],
        borderWidth: 2
      }],
    },
    options: {
      onClick: function (event, elements) {
        if (elements.length > 0) {
          const selectedIndex = elements[0].index;
          console.log(selectedIndex);
          updateExpenseChart(selectedIndex);
        }
      }
    }
  });

  function updateExpenseChart(selectedIndex) {
    const updatedExpensesData = expensesData.map((value, index) => (index === selectedIndex ? value : 0));
    expensesChartDaily.data.datasets[0].data = updatedExpensesData;
    expensesChartDaily.update();
  }

  
  const expensesChartDaily = new Chart(expensesChartDailyCtx, {
    type: 'bar',
    data: {
      labels: months,
      datasets: [{
        label: 'Monthly Expenses',
        data: expensesData,
        backgroundColor: [

          'rgba(255, 87, 51, 0.5)'
        ],
        borderColor: [

          'rgba(0, 0, 0, 0.5)'
        ],
        borderWidth: 2
      }],
    },
  });
  



</script>






{% endblock extra_javascript %}