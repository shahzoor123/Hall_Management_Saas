{% extends 'partials/base.html' %} {% load static %} {% block title%}Dashboard{% endblock title %} {% block extra_css %}
<!-- plugin css -->
<link href="{% static 'libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css' %}" rel="stylesheet"
    type="text/css" />
    <link href="{% static 'libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />

    <!-- Responsive datatable examples -->
    <link href="{% static 'libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />



{% endblock extra_css %} {% block content %}



<div class="main-content">
    <div class="page-content">
        <!-- start page title -->
        <div class="page-title-box">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-sm-6">
                        <div class="page-title">
                            <h4>Finance Dashboard</h4>
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item">
                                    <a href="javascript: void(0);">Hall</a>
                                </li>
                                <li class="breadcrumb-item">
                                    <a href="javascript: void(0);">Dashboard</a>
                                </li>
                                <li class="breadcrumb-item active">Home</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end page title -->



        <div class="container_fluid">
            <div class="row">
                <div class="col-md-6 col-sm-12">
                    <!-- Element 3 -->
                    <div class="card">
                        <div class="card-body">
                            <h4 class="header-title">Monthly Expense</h4>
                            <canvas id="expensesChartMonthly"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-sm-12">
                    <!-- Element 4 -->
                    <div class="card">
                        <div class="card-body">
                            <h4 class="header-title">Daily Expense</h4>
                            <canvas id="expensesChartDaily"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title">Event Expense</h4>
                       
                        <table id="datatable-buttons" class="table table-striped table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                            <thead>
                            <tr>
                                <th>Bill Number</th>
                                <th>Pakwan_bill</th>
                                <th>Electricity</th>
                                <th>Setup Bill</th>
                                <th>Expense Date</th>
                                <th>Total Expense</th>
                            </tr>
                            </thead>
                            <tbody>
                                {% for i in expense_table %}
                                <tr class="sale-row">
                                    <td>{{i.bill}}</td>
                                    <td>{{i.pakwan_bill}}</td>
                                    <td>{{i.electicity}}</td>
                                    <td>{{i.setup_bill}}</td>
                                    <td>{{i.expense_date}}</td>
                                    <td>{{i.total_expense}}</td>
                                </tr>
                                {% endfor %}
                           
                            </tbody>
                            <tr  id="grand-total-row">
                                <td><Strong>Grand Total -></Strong></td>
                                <td></td>
                                <td></td>
                         
                                <td><strong></strong></td>
                                <td><strong></strong></td>
                                <td ><strong ></strong></td>
                            </tr>
                        </table>
                        <script>
                            // Function to calculate grand totals
                            function calculateGrandTotals() {
                              let totalReceived = 0;
                              let totalRemaining = 0;
                              let grandTotal = 0; // Use a separate variable for the grand total
        
                              const saleRows = document.getElementsByClassName("sale-row");
        
                              for (let i = 0; i < saleRows.length; i++) {
                                const cells = saleRows[i].getElementsByTagName("td");
                                if (cells.length === 8) {
                                  const total = parseFloat(cells[5].textContent);
                                  const receivedAmount = parseFloat(cells[6].textContent);
                                  const remainingAmount = parseFloat(cells[7].textContent);
        
                                  grandTotal += total; // Calculate the grand total for the "Total" column
                                  totalReceived += receivedAmount;
                                  totalRemaining += remainingAmount;
                                }
                              }
                                              // Update the grand total row
                            const grandTotalRow = document.getElementById("grand-total-row");
                            grandTotalRow.getElementsByTagName("td")[5].textContent =  totalReceived;
                            grandTotalRow.getElementsByTagName("td")[5].style.fontWeight = "bold";
                            grandTotalRow.getElementsByTagName("td")[6].textContent =  totalReceived;
                            grandTotalRow.getElementsByTagName("td")[6].style.fontWeight = "bold";
                            grandTotalRow.getElementsByTagName("td")[7].textContent =  totalRemaining;
                            grandTotalRow.getElementsByTagName("td")[7].style.fontWeight = "bold";
        
                          }
                        
                          // Function to create a MutationObserver
                          function createMutationObserver() {
                            const tableBody = document.querySelector("table tbody");
                            const observer = new MutationObserver(function (mutationsList) {
                              // Recalculate grand totals when a mutation is observed
                              calculateGrandTotals();
                            });
                        
                            // Configure and start the observer
                            const config = { childList: true, subtree: true };
                            observer.observe(tableBody, config);
                          }
                        
                          // Call the function to calculate grand totals initially
                          calculateGrandTotals();
                        
                          // Call the function to create the MutationObserver
                          createMutationObserver();
                        </script>
                        
                    </div>
                </div>
            </div> <!-- end col -->
        </div> <!-- end row -->

    </div>
</div>

</div>
</div>

</div>
</div>


<h1 hidden id="expense" data-my-variable="{{expense}}"></h1>
<h1 hidden id="daily_expense" data-my-variable="{{daily_expense}}"></h1>


<!-- End Page-content -->
{% endblock content %} {% block extra_javascript %}


<!-- apexcharts -->
<!-- <script src="{% static 'libs/apexcharts/dist/apexcharts.min.js' %}"></script> -->
<!-- Plugins js-->
<script src="{% static 'libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>
<script src="{% static 'libs/admin-resources/jquery.vectormap/maps/jquery-jvectormap-world-mill-en.js' %}"></script>

<!-- <script src="{% static 'js/pages/dashboard.init.js' %}"></script> -->
<script src="{% static 'libs/chart.js/dist/Chart.bundle.min.js' %}"></script>
<script src="{% static 'js/pages/chartjs.init.js' %}"></script>
<script src="{% static 'libs/chartist/dist/chartist.min.js' %}"></script>
<script src="{% static 'libs/chartist-plugin-tooltips-updated/dist/chartist-plugin-tooltip.min.js' %}"></script>
<script src="{% static 'js/pages/chart.js' %}"></script>

<!-- Required datatable js -->
<script src="{% static 'libs/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<!-- Buttons examples -->
<script src="{% static 'libs/datatables.net-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js' %}"></script>
<script src="{% static 'libs/jszip/dist/jszip.min.js' %}"></script>
<script src="{% static 'libs/pdfmake/build/pdfmake.min.js' %}"></script>
<script src="{% static 'libs/pdfmake/build/vfs_fonts.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.html5.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.print.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.colVis.min.js' %}"></script>
<!-- Responsive examples -->
<script src="{% static 'libs/datatables.net-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js' %}"></script>

<!-- Datatable init js -->
<script src="{% static 'js/pages/report_datatables.init.js' %}"></script>

<script>




    // Get the values from the data attributes

    var montly_expense = document.getElementById("expense").getAttribute("data-my-variable");
    var daily_expense = JSON.parse(document.getElementById("daily_expense").getAttribute("data-my-variable"));

    console.log(daily_expense, 'expense');
    
      // Define the desired number of days in a month
    var numberOfDays = 30; // Change this based on the actual number of days in a month
    var totalExpense = JSON.parse(montly_expense);
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];


    const expensesData = Array.from({ length: 12 }, () => Math.floor(Math.random() * 500));

    const expensesChartMonthlyCtx = document.getElementById('expensesChartMonthly').getContext('2d');
    const expensesChartDailyCtx = document.getElementById('expensesChartDaily').getContext('2d');




    // const dailyExpenseData = {
    //   'Jan': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'Feb': Array.from({ length: 28 }, () => Math.floor(Math.random() * 51)),
    //   'Mar': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'Apr': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'May': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'Jun': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'Jul': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'Aug': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'Sep': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'Oct': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'Nov': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51)),
    //   'Dec': Array.from({ length: 30 }, () => Math.floor(Math.random() * 51))
    // };


    // Initialize an empty object for the transformed data
    var dailyExpenseData = {};

    // Loop through the original data
    for (var month in daily_expense) {
        // Get the array for the current month from the original data
        var originalMonthData = daily_expense[month];

        // Create a new array for the desired number of days
        var transformedMonthData = Array.from({ length: numberOfDays }, function (_, index) {
            return originalMonthData[index] || 0;
        });

        // Add the transformed data to the result object
        dailyExpenseData[month] = transformedMonthData;
    }



    const expensesChartMonthly = new Chart(expensesChartMonthlyCtx, {
        type: 'bar',
        data: {
            labels: months,
            datasets: [{
                label: 'Monthly Expenses',
                data: totalExpense,
                backgroundColor: [

                    'rgba(255, 87, 51, 0.5)'
                ],
                borderColor: [

                    'rgba(0, 0, 0, 0.5)'
                ],
                borderWidth: 2
            }],
        },
        options: {
            onClick: function (event, elements) {
                if (elements.length > 0) {
                    const selectedIndex = elements[0].index;
                    console.log(selectedIndex);
                    const selectedMonth = months[selectedIndex];
                    updateExpenseChart(selectedMonth);
                }
            }
        }
    });

    function updateExpenseChart(selectedMonth) {
        // Get daily expense data for the selected month
        const dailyData = dailyExpenseData[selectedMonth];

        // Update the daily chart with the new data
        expensesChartDaily.data.datasets[0].data = dailyData;
        expensesChartDaily.update();
    }



    const expensesChartDaily = new Chart(expensesChartDailyCtx, {
        type: 'bar',
        data: {
            labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Day 8', 'Day 9', 'Day 10', 'Day 11', 'Day 12', 'Day 13', 'Day 14', 'Day 15', 'Day 16', 'Day 17', 'Day 18', 'Day 19', 'Day 20', 'Day 21', 'Day 22', 'Day 23', 'Day 24', 'Day 25', 'Day 26', 'Day 27', 'Day 28', 'Day 29', 'Day 30'],
            datasets: [{
                label: 'Monthly Expenses',
                data: dailyExpenseData[months[0]],
                backgroundColor: [

                    'rgba(255, 87, 51, 0.5)'
                ],
                borderColor: [

                    'rgba(0, 0, 0, 0.5)'
                ],
                borderWidth: 2
            }],
        },
    });


</script>

{% endblock extra_javascript %}